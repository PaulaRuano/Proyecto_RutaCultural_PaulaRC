<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Hacer Ruta</title>
	<!-- Google Fonts -->
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@400;700;900&family=Unna:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel="stylesheet">
	<!-- Bootstrap CSS -->
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
	<!-- Archivo CSS -->		
    <link rel="stylesheet" th:href="@{/css/estilos.css}">	
</head>
<body>
	<!-- Incluir la barra de navegación -->
	<div th:insert="~{fragmentos/nav :: nav}"></div>
	 <!-- Contenido principal -->
	 <div class="container my-4">
	        <h1 class="text-center">Hacer Ruta</h1>

			<!-- Contenedor del mapa -->
			    <div id="map" class="mb-4" style="height: 400px; border: 1px solid #ccc;"></div>

			    <!-- Lista de puntos -->
			    <div class="timeline">
			        <div class="point active" th:each="punto, iterStat : ${puntos}" th:classappend="${iterStat.index == 0} ? 'active' : 'pending'">
			            <div class="circle"></div>
			            <span th:text="${punto.nombreOrganismo}">Punto 1</span>
			        </div>
			    </div>

			    <!-- Información del punto actual -->
			    <div class="current-point">
			        <h3 class="text-center" th:text="${puntos[0].nombreOrganismo}">Nombre del Primer Punto</h3>
			        <div class="text-center">
			            <img th:src="@{'/img/puntosInteres/' + ${puntos[0].id} + '.jpg'}" 
			                 onerror="this.src='/img/ImgComunPI.png'" 
			                 alt="Imagen del punto" 
			                 class="img-fluid mb-3">
			        </div>
			        <div class="text-center">
			            <button class="btn btn-primary">
			                <i class="bi bi-play-circle"></i> Reproducir Audio
			            </button>
			        </div>
			        <p class="mt-3">
			            <!-- Descripción del punto -->
			            Aquí va la descripción del punto. Incluye detalles interesantes sobre el lugar y cualquier otra información relevante.
			        </p>
			        <div class="text-center mt-4">
			            <button class="btn btn-success">Ir al Siguiente Punto</button>
			        </div>
			    </div>
			</div>

	  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCLMpyfvOmoEXcXj0TS7MwYk39OAz2c530&libraries=places&callback=initMap" async defer></script>
	  <script>
	        let map;
	        let directionsService;
	        let directionsRenderer;

	        function initMap() {
	            directionsService = new google.maps.DirectionsService();
	            directionsRenderer = new google.maps.DirectionsRenderer();

	            map = new google.maps.Map(document.getElementById("map"), {
	                center: { lat: 40.416775, lng: -3.703790 },
	                zoom: 10
	            });

	            directionsRenderer.setMap(map);

	            // Puntos reales cargados desde la vista en el servidor
	            const puntos = /*[[${puntos}]]*/ [];

	            // Convertir puntos para el mapa
	            const puntosMapa = puntos.map(p => ({
	                lat: parseFloat(p.latitud),
	                lng: parseFloat(p.longitud),
	                name: p.nombreOrganismo
	            }));

	            calculateRoute(puntosMapa);
	        }

	        function calculateRoute(puntos) {
	            if (puntos.length < 2) return;

	            const waypoints = puntos.slice(1, -1).map(point => ({
	                location: new google.maps.LatLng(point.lat, point.lng),
	                stopover: true
	            }));

	            const request = {
	                origin: new google.maps.LatLng(puntos[0].lat, puntos[0].lng),
	                destination: new google.maps.LatLng(puntos[puntos.length - 1].lat, puntos[puntos.length - 1].lng),
	                waypoints,
	                travelMode: google.maps.TravelMode.DRIVING
	            };

	            directionsService.route(request, (result, status) => {
	                if (status === google.maps.DirectionsStatus.OK) {
	                    directionsRenderer.setDirections(result);
	                }
	            });
	        }

	        document.addEventListener("DOMContentLoaded", initMap);
	    </script>
	 <!--Footer-->
	 <div th:insert="~{fragmentos/footer :: footer}"></div>
	 <!-- Bootstrap JS -->
	 <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
